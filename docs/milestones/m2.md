# M2 Milestone (Completed)

## Scope

- Segment-based EN->TR translation
- Timing-aware text adaptation for dubbing constraints
- Translation quality and terminology checks

## Implemented

- `prepare-m2` CLI command to generate translation input contract from M1 transcript
- `run-m2` CLI command to generate translation output + M2 QA report
- `benchmark-m2` CLI command to compare multiple M2 profiles
- Translation backend abstraction:
  - `mock` backend (pipeline validation)
  - `transformers` backend (local open-source model, current default: `facebook/m2m100_418M`)
- Optional glossary postprocess in M2 translation stage
- M2 QA checks:
  - length ratio bounds
  - terminal punctuation consistency
  - glossary term match/miss tracking
  - long-segment fluency heuristics (missing terminal punctuation, excessive pause punctuation)
- Optional QA acceptance gate:
  - `translate.qa_fail_on_flags = true`
  - `translate.qa_allowed_flags = []` (whitelist)
- Output contract file:
  - `output/translate/translation_input.en-tr.json`
  - `output/translate/translation_output.en-tr.json`
  - `output/qa/m2_qa_report.json`
  - `run_m2_manifest.json` (timing + speed stats)
  - `benchmarks/m2_profile_benchmark.json` (profile comparison)
- Repeated source segment deduplication for faster translation runs
- UTF-8 mojibake repair in translation backend output normalization

## CLI Entry

```bash
video-translate prepare-m2 --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate run-m2 --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate benchmark-m2 --run-root runs/m1_YYYYMMDD_HHMMSS
```

Hardware profile example (GTX 1650 + 16GB RAM):

```bash
video-translate run-m2 --run-root runs/m1_YYYYMMDD_HHMMSS --config configs/profiles/gtx1650_i5_12500h.toml
```

Faster profile (lower latency):

```bash
video-translate run-m2 --run-root runs/m1_YYYYMMDD_HHMMSS --config configs/profiles/gtx1650_fast.toml
```

## Completion Evidence (2026-02-17)

- Real M1 -> M2 run completed on:
  - `runs/finalize_m1m2/m1_real_medium_cpu`
- Output contracts produced:
  - `runs/finalize_m1m2/m1_real_medium_cpu/output/translate/translation_input.en-tr.json`
  - `runs/finalize_m1m2/m1_real_medium_cpu/output/translate/translation_output.en-tr.json`
  - `runs/finalize_m1m2/m1_real_medium_cpu/output/qa/m2_qa_report.json`
  - `runs/finalize_m1m2/m1_real_medium_cpu/run_m2_manifest.json`
- QA result:
  - `quality_flags: []`
- Profile benchmark result:
  - `runs/finalize_m1m2/m1_real_medium_cpu/benchmarks/m2_profile_benchmark.json`
  - recommended profile: `gtx1650_fast`
