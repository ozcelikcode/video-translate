# M3 Milestone (In Progress)

## Scope Target

- Turkish TTS synthesis from M2 translation output
- Basic duration-fit checks for dubbing timeline compatibility
- M3 QA report and acceptance gate

## Implemented So Far

- `prepare-m3` CLI command to convert M2 translation output into M3 TTS input contract
- `run-m3` CLI command to synthesize per-segment WAV output + M3 QA report
- `benchmark-m3` CLI command to compare multiple M3 profiles on same TTS input
- `report-m3-tuning` CLI command to generate markdown tuning summary from M3 benchmark
- `finalize-m3-profile` CLI command to lock benchmark recommended profile into a stable config
- `tune-m3-espeak` CLI command for automated espeak candidate tuning and profile locking
- `finish-m3` CLI command for M3 closing workflow with strict QA gate
- `ui` CLI command for local web UI flow
  - includes YouTube URL based `M1 -> M2 -> (optional) M3` trigger path
- TTS backend abstraction:
  - `mock` backend (local sine-wave placeholder synthesis for pipeline validation)
  - `espeak` backend (local real synthesis, API-free)
- `espeak` backend duration-fit iyilestirmesi:
  - adaptive speaking-rate retry loop (`espeak_adaptive_rate_*` config alanlari)
- backend sonrasi duration-fit iyilestirmesi:
  - hedef sureden uzun kalan segmentlerde WAV trim (post-fit)
  - hedef sÃ¼reden kisa kalan segmentlere sessizlik padding (post-fit)
- M3 QA checks:
  - duration tolerance delta (`max_duration_delta_seconds`)
  - empty target text detection
  - excessive post-fit adjustment detection
    - `postfit_segment_ratio_above_max`
    - `postfit_seconds_ratio_above_max`
- Optional M3 QA acceptance gate:
  - `tts.qa_fail_on_flags`
  - `tts.qa_allowed_flags`
- Output artifacts:
  - `output/tts/tts_input.tr.json`
  - `output/tts/tts_output.tr.json`
  - `output/tts/segments/seg_XXXXXX.wav`
  - `output/tts/tts_preview_stitched.tr.wav`
  - `output/qa/m3_qa_report.json`
  - `run_m3_manifest.json`
  - `benchmarks/m3_profile_benchmark.json`
  - `benchmarks/m3_tuning_report.md`
- M3 benchmark/tuning raporu post-fit metriklerini de tasir:
  - `postfit_padding_segments`
  - `postfit_trim_segments`
  - `postfit_total_padded_seconds`
  - `postfit_total_trimmed_seconds`

## CLI Entry

```bash
video-translate prepare-m3 --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate run-m3 --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate benchmark-m3 --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate report-m3-tuning --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate finalize-m3-profile --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate tune-m3-espeak --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate finish-m3 --run-root runs/m1_YYYYMMDD_HHMMSS
video-translate ui --host 127.0.0.1 --port 8765
```

## Next M3 Steps

- Tune `espeak` voice/rate/pitch profiles with real sample set
- Segment-level pause shaping / micro-timing heuristics for tighter rhythm
